<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Ohalik Tours</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/dashboard.css">
</head>
<body>
    <div class="dashboard-container">
        <!-- Sidebar -->
        <div class="dashboard-sidebar">
            <div class="sidebar-header">
                <h2><span>OHALIK</span> TOURS</h2>
            </div>
            
            <nav class="sidebar-nav">
                <ul>
                    <li class="active"><a href="/dashboard"><i class="icon profile-icon"></i> My Profile</a></li>
                    <li><a href="/dashboard/bookings"><i class="icon bookings-icon"></i> My Bookings</a></li>
                    <li><a href="/dashboard/documents"><i class="icon documents-icon"></i> Documents</a></li>
                    <li><a href="/dashboard/wishlist"><i class="icon wishlist-icon"></i> Wishlist</a></li>
                    <li class="nav-divider"></li>
                    <li><a href="/tours"><i class="icon tours-icon"></i> Browse Tours</a></li>
                    <li><a href="/logout"><i class="icon logout-icon"></i> Logout</a></li>
                </ul>
            </nav>
            
            <div class="sidebar-footer">
                <p>&copy; 2025 Ohalik Tours</p>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="dashboard-content">
            <div class="dashboard-header">
                <h1>My Profile</h1>
                <div class="user-welcome">
                    Welcome, <%= user.firstName %>!
                </div>
            </div>
            
            <div class="dashboard-body">
                <!-- Profile Information Card -->
                <div class="dashboard-card">
                    <div class="card-header">
                        <h3>Personal Information</h3>
                        <button id="editProfileBtn" class="btn-small">Edit</button>
                    </div>
                    
                    <div class="card-body">
                        <% if (typeof message !== 'undefined') { %>
                            <div class="alert alert-success">
                                <%= message %>
                            </div>
                        <% } %>
                        
                        <div id="profileDisplay">
                            <div class="profile-info">
                                <div class="profile-avatar">
                                    <div class="avatar-placeholder">
                                        <%= user.firstName.charAt(0) %><%= user.lastName.charAt(0) %>
                                    </div>
                                </div>
                                
                                <div class="profile-details">
                                    <div class="info-group">
                                        <label>Full Name</label>
                                        <p><%= user.firstName %> <%= user.lastName %></p>
                                    </div>
                                    
                                    <div class="info-group">
                                        <label>Email</label>
                                        <p><%= user.email %></p>
                                    </div>
                                    
                                    <div class="info-group">
                                        <label>Birth Date</label>
                                        <p><%= user.birthDate ? new Date(user.birthDate).toLocaleDateString() : 'Not provided' %></p>
                                    </div>
                                    
                                    <div class="info-group">
                                        <label>Newsletter</label>
                                        <p><%= user.isSubscribed ? 'Subscribed' : 'Not subscribed' %></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div id="profileEditForm" style="display: none;">
                            <form action="/dashboard/update-profile" method="POST">
                                <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="firstName">First Name</label>
                                        <input type="text" id="firstName" name="firstName" value="<%= user.firstName %>" required>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="lastName">Last Name</label>
                                        <input type="text" id="lastName" name="lastName" value="<%= user.lastName %>" required>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="email">Email</label>
                                    <input type="email" id="email" name="email" value="<%= user.email %>" required disabled>
                                    <small>Email cannot be changed</small>
                                </div>
                                
                                <div class="form-group">
                                    <label for="birthDate">Birth Date</label>
                                    <input type="date" id="birthDate" name="birthDate" value="<%= user.birthDate ? new Date(user.birthDate).toISOString().split('T')[0] : '' %>">
                                </div>
                                
                                <div class="form-group">
                                    <label class="toggle-label">
                                        <input type="checkbox" id="isSubscribed" name="isSubscribed" <%= user.isSubscribed ? 'checked' : '' %>>
                                        <span class="toggle-text">Subscribe to newsletter</span>
                                    </label>
                                </div>
                                
                                <div class="form-group">
                                    <button type="submit" class="btn">Save Changes</button>
                                    <button type="button" id="cancelEditBtn" class="btn btn-outline">Cancel</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                
                <!-- Password Change Card -->
                <div class="dashboard-card">
                    <div class="card-header">
                        <h3>Security</h3>
                    </div>
                    
                    <div class="card-body">
                        <form action="/dashboard/change-password" method="POST">
                            <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                            
                            <div class="form-group">
                                <label for="currentPassword">Current Password</label>
                                <input type="password" id="currentPassword" name="currentPassword" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="newPassword">New Password</label>
                                <input type="password" id="newPassword" name="newPassword" required minlength="8">
                            </div>
                            
                            <div class="form-group">
                                <label for="confirmPassword">Confirm New Password</label>
                                <input type="password" id="confirmPassword" name="confirmPassword" required minlength="8">
                            </div>
                            
                            <div class="form-group">
                                <button type="submit" class="btn">Change Password</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const editProfileBtn = document.getElementById('editProfileBtn');
            const cancelEditBtn = document.getElementById('cancelEditBtn');
            const profileDisplay = document.getElementById('profileDisplay');
            const profileEditForm = document.getElementById('profileEditForm');
            
            // Toggle between display and edit mode
            editProfileBtn.addEventListener('click', () => {
                profileDisplay.style.display = 'none';
                profileEditForm.style.display = 'block';
            });
            
            cancelEditBtn.addEventListener('click', () => {
                profileDisplay.style.display = 'block';
                profileEditForm.style.display = 'none';
            });
            
            // Password confirmation validation
            const passwordForm = document.querySelector('form[action="/dashboard/change-password"]');
            if (passwordForm) {
                passwordForm.addEventListener('submit', (e) => {
                    const newPassword = document.getElementById('newPassword').value;
                    const confirmPassword = document.getElementById('confirmPassword').value;
                    
                    if (newPassword !== confirmPassword) {
                        e.preventDefault();
                        alert('Passwords do not match!');
                    }
                });
            }
        });
    </script>
</body>
</html>
